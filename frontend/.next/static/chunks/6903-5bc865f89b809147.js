"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6903],{26903:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var r=n(34051),o=n.n(r),a=n(85893),u=n(67294),s=n(41664),i=n(42896),c=n(58650),l=n(45795),d=n(25617),f=n(28565),m=n(99403),v=n(40424),p=n(57191),h=n(11163),b=n(92814),x=n(66367),g=n(25600),j=n(51436);function y(e,t,n,r,o,a,u){try{var s=e[a](u),i=s.value}catch(c){return void n(c)}s.done?t(i):Promise.resolve(i).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function u(e){y(a,r,o,u,s,"next",e)}function s(e){y(a,r,o,u,s,"throw",e)}u(void 0)}))}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){N(e,t,n[t])}))}return e}function S(e){var t=(0,h.useRouter)(),n=(0,u.useState)(!0),r=n[0],y=n[1],N=(0,u.useRef)(r);N.current=r;var S=(0,u.useState)()[0],O=(0,d.v9)((function(e){return e.hosts.hosts})),C=(0,u.useRef)(O);C.current=O;var I=(0,d.v9)((function(e){return e.hosts.activeHost})),R=(0,u.useRef)(I);R.current=I;var V=(0,u.useState)(),T=V[0],P=V[1],z=(0,u.useRef)(T);z.current=T;var F=(0,d.v9)((function(e){return e.volumes})),A=(0,u.useState)(),E=A[0],_=A[1],D=(0,u.useRef)(E);D.current=E;var M=(0,u.useState)(!1),L=M[0],G=M[1],q=(0,u.useState)(),H=q[0],K=q[1];(0,u.useRef)(H).current=H;var U=(0,u.useState)(),B=U[0],J=U[1],Q=(0,u.useRef)(B);Q.current=B;var W=(0,u.useState)(),X=W[0],Y=W[1],Z=(0,u.useState)(""),$=Z[0],ee=Z[1];function te(){return ne.apply(this,arguments)}function ne(){return(ne=k(o().mark((function n(){var r,a;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(L){n.next=4;break}return n.next=4,ae();case 4:if(ie(),!(null===(r=t.query)||void 0===r?void 0:r.hostId)){n.next=14;break}if(!C.current){n.next=11;break}return a=C[t.query.hostId],P(a),setTimeout((function(){return re()})),n.abrupt("return");case 11:return P(e.host),setTimeout((function(){return re()})),n.abrupt("return");case 14:if(!e.host){n.next=18;break}return P(e.host),setTimeout((function(){return re()})),n.abrupt("return");case 18:R&&(P(R.current),setTimeout((function(){return re()})));case 19:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function re(){return oe.apply(this,arguments)}function oe(){return(oe=k(o().mark((function e(){var t,n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w({},F),z.current||(null===(t=z.current)||void 0===t?void 0:t.id)){e.next=4;break}return e.abrupt("return");case 4:if(F&&(null===(n=F[z.current.id])||void 0===n?void 0:n.volumes)){e.next=6;break}return e.abrupt("return");case 6:r=F[z.current.id].volumes,a=Object.keys(r).map((function(e){return r[e]})),K(a),y(!1);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return ue.apply(this,arguments)}function ue(){return(ue=k(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L){e.next=2;break}return e.abrupt("return");case 2:return G(!0),e.next=5,f.L.getSocket();case 5:return(t=e.sent).on("volumes_list",(function(e){if("success"===e.status&&e.data){var t=e.data.sort((function(e,t){return e.name||(e.name=e.volumeId),e.name.localeCompare(t.name)}));K(t)}})),_(t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return(se=k(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D.current.emit("docker",{command:"listVolumes",callback:"volumesList",hostId:z.current.id}),y(!0),setTimeout((function(){y(!1)}),1e3);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,u.useEffect)(k(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te();case 1:case"end":return e.stop()}}),e)}))),[]),(0,u.useEffect)(k(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te();case 1:case"end":return e.stop()}}),e)}))),[I,F]),(0,u.useEffect)((function(){return function(){(null===D||void 0===D?void 0:D.current)&&D.current.removeListener("volumes_list")}}),[]);var ie=function(){Y({global:{value:null,matchMode:x.a6.CONTAINS},name:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]},project:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]},containerId:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]}})};if(S)return(0,a.jsxs)("div",{children:["Failed to load Volumes: ",S]});if(!F)return(0,a.jsx)("div",{children:"No Volumes."});if(0===F.length)return(0,a.jsx)("div",{children:"No Volumes."});var ce=function(e){var t;D.current.emit("docker",{command:"removeVolume",volumeId:e.volumeId,hostId:null===(t=e.host)||void 0===t?void 0:t.id,callback:"dockerResuls_volumes"+e.id,hook:"removeVolume"})},le=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,v.V)({className:"confirm-dialogs",message:n,target:(null===r||void 0===r?void 0:r.currentTarget)?r.currentTarget:null,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){switch(e){case"removeVolume":ce(t);break;case"removeSelected":de()}}})},de=function(){Q.current.forEach((function(e){var t;0===(null===(t=e.containers)||void 0===t?void 0:t.length)&&ce(e)})),J(null)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"col-12 p-0 m-0",children:[(0,a.jsxs)("div",{className:"col-12 p-0 m-0 pr-1 grid",children:[(0,a.jsx)("div",{className:"col-6",children:(0,a.jsxs)("h2",{children:[(0,a.jsx)(b.G,{icon:j.Pk,pull:"left",className:"fa-1x lightblue-color mt-0 pt-0",swapOpacity:!0}),"Docker Volumes"]})}),(0,a.jsxs)("div",{className:"col-6 text-right pr-0",children:[(0,a.jsxs)("span",{className:"p-input-icon-left mr-3",children:[(0,a.jsx)("i",{className:"pi pi-search"}),(0,a.jsx)(g.o,{value:$,onChange:function(e){var t=e.target.value,n=w({},X);n.global.value=t,Y(n),ee(t)},placeholder:"Keyword Search"})]}),(0,a.jsx)(m.z,{label:"Volume",className:"p-button-secondary mr-2",icon:"fa fa-plus",onClick:function(){return t.push("/volumes/create")}}),(0,a.jsx)("button",{className:"p-button p-component p-button-secondary mt-1 p-2",label:"",onClick:function(){return function(){return se.apply(this,arguments)}()},children:(0,a.jsx)(b.G,{icon:j.lUd,className:"mt-0 p-1",swapOpacity:!0})})]})]}),(0,a.jsxs)(i.w,{value:H,stripedRows:!0,rowHover:!0,showGridlines:!0,selection:B,onSelectionChange:function(e){return function(e){J(e.value)}(e)},paginator:!0,rows:15,totalRecords:null===H||void 0===H?void 0:H.length,dataKey:"id",rowsPerPageOptions:[10,15,20,50,100,200],sortMode:"single",responsiveLayout:"scroll",sortField:"name",sortOrder:1,filters:X,filterDisplay:"menu",loading:N.current,globalFilterFields:["name","imageId","tag"],children:[(0,a.jsx)(c.s,{sortable:!0,field:"name",header:"Name",filter:!0,filterPlaceholder:"Search by name",body:function(e){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(s.default,{href:"/volumes/[id]",as:"/volumes/".concat(e.id),children:(0,a.jsx)("a",{className:"lightblue-color",children:(0,a.jsx)("b",{children:e.name})})})})}}),(0,a.jsx)(c.s,{sortable:!0,field:"containers",header:"Status",align:"center",body:function(e){var t;return(null===e||void 0===e||null===(t=e.containers)||void 0===t?void 0:t.length)>0?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(s.default,{href:"/volumes/[id]",as:"/volumes/".concat(e.id),children:(0,a.jsx)("a",{children:(0,a.jsx)(l.C,{size:"",value:"In Use",severity:"success"})})})}):(0,a.jsx)("div",{children:e.containers.length})}}),(0,a.jsx)(c.s,{sortable:!0,field:"fileSize",header:"Size",align:"center",body:function(e){return e.fileSize?(0,a.jsx)(a.Fragment,{children:p.t.bytes(Number(e.fileSize))}):(0,a.jsx)("div",{children:p.t.bytes(Number(e.fileSize))})}}),(0,a.jsx)(c.s,{field:"id",header:"Actions",align:"center",body:function(e){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(m.z,{label:"",onClick:function(t){le("removeVolume",e,"Remove "+e.name+"?",t)},className:"p-button-secondary",icon:"pi pi-trash"})})}}),(0,a.jsx)(c.s,{selectionMode:"multiple",headerStyle:{width:"3em"}})]}),(null===B||void 0===B?void 0:B.length)>0&&(0,a.jsx)("div",{className:"col-12 text-right pr-2",children:(0,a.jsx)(m.z,{className:"mt-2 p-button-warning",label:"Remove Selected",icon:"fa fa-trash",onClick:function(e){return le("removeSelected",null,"Remove Selected Volumes?",e)}})})]})})}}}]);