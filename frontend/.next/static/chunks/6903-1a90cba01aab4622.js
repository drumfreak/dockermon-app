"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6903],{26903:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(34051),o=t.n(r),l=t(85893),i=t(67294),s=t(41664),a=t(42896),c=t(58650),u=t(45795),d=t(25617),f=t(28565),v=t(99403),m=t(40424),h=t(57191),p=t(11163),b=t(92814),x=t(66367),g=t(25600),j=t(51436);function y(e,n,t,r,o,l,i){try{var s=e[l](i),a=s.value}catch(c){return void t(c)}s.done?n(a):Promise.resolve(a).then(r,o)}function N(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var l=e.apply(n,t);function i(e){y(l,r,o,i,s,"next",e)}function s(e){y(l,r,o,i,s,"throw",e)}i(void 0)}))}}function S(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function w(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){S(e,n,t[n])}))}return e}function k(){var e=(0,p.useRouter)(),n=(0,i.useState)(!0),t=n[0],r=n[1],y=(0,i.useRef)(t);y.current=t;var S=(0,i.useState)(null)[0],k=(0,d.v9)((function(e){return e.hosts.hosts}));(0,i.useRef)(k).current=k;var O=(0,d.v9)((function(e){return e.hosts.activeHost})),C=(0,i.useRef)(O);C.current=O;var R=(0,d.v9)((function(e){return e.volumes})),V=(0,i.useState)(null),I=V[0],P=V[1],z=(0,i.useRef)(I);z.current=I;var A=(0,i.useState)(!1),F=A[0],E=A[1],T=(0,i.useState)(null),_=T[0],D=T[1];(0,i.useRef)(_).current=_;var M=(0,i.useState)(null),L=M[0],G=M[1],H=(0,i.useRef)(L);H.current=L;var K=(0,i.useState)(null),U=K[0],q=K[1],B=(0,i.useState)(""),J=B[0],Q=B[1];function W(){return X.apply(this,arguments)}function X(){return(X=N(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!F){e.next=2;break}return e.abrupt("return");case 2:return E(!0),e.next=5,f.L.getSocket();case 5:return(n=e.sent).on("volumes_list",(function(e){if("success"===e.status&&e.data){var n=e.data;D(n)}})),P(n),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return(Y=N(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z.current.emit("docker",{command:"listVolumes",callback:"volumesList",hostId:C.current.id}),r(!0),setTimeout((function(){r(!1)}),1e3);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,i.useEffect)(N(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F){e.next=3;break}return e.next=3,W();case 3:Z();case 4:case"end":return e.stop()}}),e)}))),[]),(0,i.useEffect)((function(){var e,n=w({},R);if((O||(null===O||void 0===O?void 0:O.id))&&R&&(null===(e=R[O.id])||void 0===e?void 0:e.volumes)){n=R[O.id].volumes;var t=Object.keys(n).map((function(e){return n[e]}));D(t),r(!1)}}),[O,R]),(0,i.useEffect)((function(){return function(){(null===z||void 0===z?void 0:z.current)&&z.current.removeListener("volumes_list")}}),[]);var Z=function(){q({global:{value:null,matchMode:x.a6.CONTAINS},name:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]},project:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]},containerId:{operator:x.pg.AND,constraints:[{value:null,matchMode:x.a6.CONTAINS}]}})};if(S)return(0,l.jsxs)("div",{children:["Failed to load Volumes: ",S]});if(!R)return(0,l.jsx)("div",{children:"No Volumes."});if(0===R.length)return(0,l.jsx)("div",{children:"No Volumes."});var $=function(e){var n;z.current.emit("docker",{command:"removeVolume",volumeId:e.volumeId,hostId:null===(n=e.host)||void 0===n?void 0:n.id,callback:"dockerResuls_volumes"+e.id,hook:"removeVolume"})},ee=function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,m.V)({className:"confirm-dialogs",message:t,target:(null===r||void 0===r?void 0:r.currentTarget)?r.currentTarget:null,header:"Confirmation",icon:"pi pi-exclamation-triangle",accept:function(){switch(e){case"removeVolume":$(n);break;case"removeSelected":ne()}}})},ne=function(){H.current.forEach((function(e){var n;0===(null===(n=e.containers)||void 0===n?void 0:n.length)&&$(e)})),G(null)};return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"col-12 p-0 mt-2 pr-1 grid",children:[(0,l.jsx)("div",{className:"col-6",children:(0,l.jsxs)("h2",{children:[(0,l.jsx)(b.G,{icon:j.Pk,pull:"left",className:"fa-1x lightblue-color mt-0 pt-0",swapOpacity:!0}),"Docker Volumes"]})}),(0,l.jsxs)("div",{className:"col-6 text-right pr-0",children:[(0,l.jsxs)("span",{className:"p-input-icon-left mr-3",children:[(0,l.jsx)("i",{className:"pi pi-search"}),(0,l.jsx)(g.o,{value:J,onChange:function(e){var n=e.target.value,t=w({},U);t.global.value=n,q(t),Q(n)},placeholder:"Keyword Search"})]}),(0,l.jsx)(v.z,{label:"Volume",className:"p-button-secondary mr-2",icon:"fa fa-plus",onClick:function(){return e.push("/volumes/create")}}),(0,l.jsx)("button",{className:"p-button p-component p-button-secondary mt-1 p-2",label:"",onClick:function(){return function(){return Y.apply(this,arguments)}()},children:(0,l.jsx)(b.G,{icon:j.lUd,className:"mt-0 p-1",swapOpacity:!0})})]})]}),(0,l.jsxs)(a.w,{value:_,stripedRows:!0,rowHover:!0,showGridlines:!0,selection:L,onSelectionChange:function(e){return function(e){G(e.value)}(e)},paginator:!0,rows:15,totalRecords:null===_||void 0===_?void 0:_.length,dataKey:"id",rowsPerPageOptions:[10,15,20,50,100,200],sortMode:"single",responsiveLayout:"scroll",sortField:"name",sortOrder:1,filters:U,filterDisplay:"menu",loading:y.current,globalFilterFields:["name","imageId","tag"],children:[(0,l.jsx)(c.s,{sortable:!0,field:"name",header:"Name",filter:!0,filterPlaceholder:"Search by name",body:function(e){return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(s.default,{href:"/volumes/[id]",as:"/volumes/".concat(e.id),children:(0,l.jsx)("a",{className:"lightblue-color",children:(0,l.jsx)("b",{children:e.name})})})})}}),(0,l.jsx)(c.s,{sortable:!0,field:"containers",header:"Status",align:"center",body:function(e){var n;return(null===e||void 0===e||null===(n=e.containers)||void 0===n?void 0:n.length)>0?(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(s.default,{href:"/volumes/[id]",as:"/volumes/".concat(e.id),children:(0,l.jsx)("a",{children:(0,l.jsx)(u.C,{size:"",value:"In Use",severity:"success"})})})}):(0,l.jsx)("div",{children:e.containers.length})}}),(0,l.jsx)(c.s,{sortable:!0,field:"fileSize",header:"Size",align:"center",body:function(e){return e.fileSize?(0,l.jsx)(l.Fragment,{children:h.t.bytes(Number(e.fileSize))}):(0,l.jsx)("div",{children:h.t.bytes(Number(e.fileSize))})}}),(0,l.jsx)(c.s,{field:"id",header:"Actions",align:"center",body:function(e){return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(v.z,{label:"",onClick:function(n){ee("removeVolume",e,"Remove "+e.name+"?",n)},className:"p-button-secondary",icon:"pi pi-trash"})})}}),(0,l.jsx)(c.s,{selectionMode:"multiple",headerStyle:{width:"3em"}})]}),(null===L||void 0===L?void 0:L.length)>0&&(0,l.jsx)("div",{className:"col-12 text-right pr-2",children:(0,l.jsx)(v.z,{className:"mt-2 p-button-warning",label:"Remove Selected",icon:"fa fa-trash",onClick:function(e){return ee("removeSelected",null,"Remove Selected Volumes?",e)}})})]})})}}}]);